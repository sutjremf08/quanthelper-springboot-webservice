
{{>layout/header}}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-lg-5">
        <a class="navbar-brand" href="#!">{{post.name}}</a>
    </div>
</nav>
<div class="py-5 bg-light">
    <div class="container px-5 my-5">
        <div class="row gx-5 justify-content-center">
            <div class="col-lg-10 col-xl-7">
                <div class="text-center">
                    <div class="fs-4 mb-4 fst-italic">기업 소개</div>
                    <div class="fs-4 mb-4 fst-italic">{{post.description}}</div>
                </div>
            </div>
        </div>
    </div>
</div>
<section class="py-5" id="features">
    <div class="container px-5 my-5">
        <div class="row gx-5">
            <div class="col-lg-4 mb-5 mb-lg-0">
                <h2 class="fw-bolder mb-0">{{post.name}}</h2>
                <h4 class="fw-bolder mb-0"> 업종 : {{post.sector}}</h4>
                <h4 class="fw-bolder mb-0"> 종가 : {{post.price}}</h4>
                <h4 class="fw-bolder mb-0"> 종목코드 : {{post.code}}</h4>
                <script>
                    var code = window.location.pathname.slice(-6);
                    console.log("code : " + code);
                </script>
            </div>
            <div class="col-lg-8">
                <div class="row gx-5 row-cols-1 row-cols-md-2">
                        {{#post.per}}
                            <div class="col mb-5 h-100">
                                <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">PER</div>
                                <h2 class="h5">{{post.per}}</h2>
                            </div>
                        {{/post.per}}
                        {{^post.per}}
                        {{/post.per}}

                        {{#post.pcr}}
                            <div class="col mb-5 h-100">
                                <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">PCR</div>
                                <h2 class="h5">{{post.pcr}}</h2>
                         </div>
                        {{/post.pcr}}
                        {{^post.pcr}}
                        {{/post.pcr}}

                        {{#post.pbr}}
                            <div class="col mb-5 mb-md-0 h-100">
                                <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">PBR</div>
                                <h2 class="h5">{{post.pbr}}</h2>
                            </div>
                        {{/post.pbr}}
                        {{^post.pbr}}
                        {{/post.pbr}}

                        {{#post.psr}}
                            <div class="col h-100">
                                <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">PSR</div>
                                <h2 class="h5">{{post.psr}}</h2>
                        </div>
                        {{/post.psr}}
                        {{^post.psr}}
                        {{/post.psr}}

                        {{#post.roa}}
                            <div class="col h-100"><div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">ROA</div>
                                <h2 class="h5">{{post.roa}}</h2>
                            </div>
                        {{/post.roa}}
                        {{^post.roa}}
                        {{/post.roa}}

                        {{#post.cfo}}
                            <div class="col h-100"><div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">CFO</div>
                            <h2 class="h5">{{post.cfo}}</h2>
                            </div>
                        {{/post.cfo}}
                        {{^post.cfo}}
                        {{/post.cfo}}

                        {{#post.lev}}
                            <div class="col h-100"><div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">LEV</div>
                            <h2 class="h5">{{post.lev}}</h2>
                            </div>
                        {{/post.lev}}
                        {{^post.lev}}
                        {{/post.lev}}

                        {{#post.liq}}
                            <div class="col h-100"><div class="feature bg-primary bg-gradient text-white rounded-3 mb-3">LIQ</div>
                            <h2 class="h5">{{post.liq}}</h2>
                            </div>
                        {{/post.liq}}
                        {{^post.liq}}
                        {{/post.liq}}

                        {{#post.turn}}
                            <div class="col h-100"><div class="feature bg-primary bg-gradient text-white rounded-2 mb-3">TUR</div>
                                <h2 class="h5">{{post.turn}}</h2>
                            </div>
                        {{/post.turn}}
                        {{^post.turn}}
                        {{/post.turn}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="py-5 border-bottom">
    <div class="container px-5 my-5 px-5">
        <div class="text-center mb-5">
            <h4 class="fw-bolder">수익률</h4>
        </div>
        <div class="row gx-5 justify-content-center" id="graph">
            <!--<div class="col-lg-6" id="graph">
            </div>-->
        </div>
    </div>
</section>
<section class="py-5 border-bottom">
    <div class="container px-5 my-5 px-5">
        <div class="text-center mb-5">
            <h4 class="fw-bolder">관련뉴스</h4>
        </div>
        <div class="row gx-5 justify-content-center" id="news">
           <!-- <div class="col-lg-6" >-->
                <!-- Testimonial 1-->
                <!--<div class="card mb-4">
                    <div class="card-body p-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0"><i class="bi bi-chat-right-quote-fill text-primary fs-1"></i></div>
                            <div class="ms-4">
                                <p class="mb-1">Thank you for putting together such a great product. We loved working with you and the whole team, and we will be recommending you to others!</p>
                                <div class="small text-muted">- Client Name, Location</div>
                            </div>
                        </div>
                    </div>
                </div>
                &lt;!&ndash; Testimonial 2&ndash;&gt;
                <div class="card">
                    <div class="card-body p-4">
                        <div class="d-flex">
                            <div class="flex-shrink-0"><i class="bi bi-chat-right-quote-fill text-primary fs-1"></i></div>
                            <div class="ms-4">
                                <p class="mb-1">The whole team was a huge help with putting things together for our company and brand. We will be hiring them again in the near future for additional work!</p>
                                <div class="small text-muted">- Client Name, Location</div>
                            </div>
                        </div>
                    </div>
                </div>-->
         <!--   </div>-->
        </div>
    </div>
</section>

<script type="text/javascript">
    $(document).ready(function(){

        var path = window.location.pathname;
        console.log(path.indexOf("value") + " :::  " + path.indexOf("magic") +" ;; "+ path.indexOf("fscore"));


        if((path.indexOf("value") > 0) && ( path.indexOf("magic") < 0) && (path.indexOf("fscore") < 0)){
            console.log("aaaa");


            var result = "";
            console.log(leadingZeros(code,6) +" ::: " +code);
            $.ajax({
                url: '/api/vi/posts/value/'+leadingZeros(code,6),
                dataType: 'json',
                type: 'POST',
                error : function(request,status,error) {

                },
                success : function(data,status) {
                    result = JSON.parse(data);
                    console.log(result);
                    Plotly.newPlot('graph',result.data,result.layout);
                }
            });
        }


        if((path.indexOf("value") < 0) && ( path.indexOf("magic") < 0) && (path.indexOf("fscore") > 0)){
            console.log("bbb");

            var result = "";
            console.log(leadingZeros(code,6) +" ::: " +code);
            $.ajax({
                url: '/api/vi/posts/fscore/'+leadingZeros(code,6),
                dataType: 'json',
                type: 'POST',
                error : function(request,status,error) {

                },
                success : function(data,status) {
                    result = JSON.parse(data);
                    console.log(result);

                    Plotly.newPlot('graph',result.data,result.layout);
                }
            });

        }

        if((path.indexOf("value") < 0) && ( path.indexOf("magic") > 0) && (path.indexOf("fscore") < 0)){

            console.log("cccc");
            console.log(leadingZeros(code,6) +" ::: " +code);
            var result = "";
            $.ajax({
                url: '/api/vi/posts/magic/'+leadingZeros(code,6),
                dataType: 'json',
                type: 'POST',
                error : function(request,status,error) {

                },
                success : function(data,status) {
                    result = JSON.parse(data);
                    console.log(result);

                    Plotly.newPlot('graph',result.data,result.layout);
                }
            });
        }

        //rss
        var ourl = "https://news.google.com/rss/search?hl=ko&gl=KR&ie=UTF-8&q={{post.name}}&ceid=KR:ko";
        $.ajax({
            url: "https://api.rss2json.com/v1/api.json?rss_url="+encodeURIComponent(ourl),
            dataType: 'json',
            type: 'POST',
            error : function(request,status,error) {

            },
            success : function(data,status) {
                var datagrid = JSON.stringify(data);
                console.log(datagrid);
                var rssPars = JSON.parse(datagrid);
                var rssGrid = "";

                console.log(rssPars)
                console.log(rssPars.items[0].title)

                var cnt = 0;
                rssGrid = "<div class='col-lg-6' >";
                while(cnt < 3){

                    rssGrid += "<div class='card mb-4'>";
                    rssGrid += "<div class='card-body p-4'>";
                    rssGrid += "<div class='d-flex'>";
                    rssGrid += "<div class='flex-shrink-0'><i class='bi bi-chat-right-quote-fill text-primary fs-1'></i></div>";
                    rssGrid += "<div class='ms-4'>";
                    rssGrid += "<p class='mb-1'>" + rssPars.items[cnt].title + "</p>";
                    rssGrid += "<div class='small text-muted'><a href=" + rssPars.items[cnt].link + " target='_blank'>"+rssPars.items[cnt].link+"</a></div>";
                    rssGrid += "</div>";
                    rssGrid += "</div>";
                    rssGrid += "</div>";
                    rssGrid += "</div>";

                    console.log("cnt :: " + cnt + " ::: " +rssPars.items[cnt].title );
                    cnt++;
                    console.log("cnt :: " + cnt + "");
                }
                rssGrid += "</div>"
                console.log(rssGrid);
                $("#news").html(rssGrid);

            }
        });


        /*  //rss 피드 개선
          var ourl = "https://news.google.com/rss/search?hl=ko&gl=KR&ie=UTF-8&q=&ceid=KR:ko";
        var surl = "https://api.rss2json.com/v1/api.json?rss_url="+encodeURIComponent(ourl);
        fetch("https://api.rss2json.com/v1/api.json?rss_url="+encodeURIComponent(ourl))
                .then(res => {
                    // response 처리
                    console.log(res);
                    // 응답을 JSON 형태로 파싱
                    return res.json();
                })
                .then(data => {
                    // json 출력
                    var htmlStr = "";

                    htmlStr += '<table class="table table-hover"><thead><tr><th scope="col">뉴스 제목</th><th scope="col">뉴스 링크</th></thead>';
                    $(data.items).each(function(){

                        htmlStr += '<tbody>';
                        htmlStr += '<tr>';
                        htmlStr += '<td>'+this.title+'</td>';
                        htmlStr += '<td>'+this.link+'</td>';
                        htmlStr += '</tr>';
                        htmlStr += '</tbody>';

                    });

                    htmlStr += '</table>';

                    // 결과 HTML을 FORM의 결과 출력 DIV에 삽입

                    $("#news").html(htmlStr);

                    //console.log(data);
                    //console.log( data.items[0].link + " LLL " + data.items[0].title)
                })
                .catch(err => {
                    // error 처리
                    console.log('Fetch Error', err);
                });*/
    });


    var leadingZeros = function (date, num) {
        var zero = '';
        date = date.toString();

        if (date.length < num) {
            for (i = 0; i < num - date.length; i++)
                zero += '0';
        }
        return zero + date;
    }
</script>
{{>layout/footer}}